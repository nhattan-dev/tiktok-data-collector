package service.impl;

import exception.CustomRuntimeException;
import org.junit.jupiter.api.Test;
import org.mockito.MockedStatic;
import org.mockito.Mockito;
import response.AdResponse;
import utils.APIUtils;
import utils.ObjectMapperUtils;

import static org.junit.jupiter.api.Assertions.*;

class AdServiceImplTest {
    AdServiceImpl s1 = AdServiceImpl.getInstance();

    @Test
    void getInstance() {
        AdServiceImpl s2 = AdServiceImpl.getInstance();
        assertEquals(s1, s2);
    }

    @Test
    void url() {
        assertTrue(s1.url().contains("ad"));
    }

    @Test
    void convert_fail_then_throw_exception() {
        String responseString = "will be throw exception";
        Exception exception = assertThrows(CustomRuntimeException.class,
                () -> s1.convert(ObjectMapperUtils.getInstance(), responseString));
        assertEquals("Convert to AdResponse failure.", exception.getMessage());
    }

    @Test
    void convert_success_then_return_object() {
        AdResponse response = s1.convert(ObjectMapperUtils.getInstance(), adResponse);
        assertEquals(response.getAdList().getAds().get(0).getAdvertiserId() + "", advertiser_id);
    }

    @Test
    void getTotalPage() {AdResponse response = s1.convert(ObjectMapperUtils.getInstance(), adResponse);
        assertEquals(1, s1.getTotalPage(response));
    }

    @Test
    void getList() {
        AdResponse response = s1.convert(ObjectMapperUtils.getInstance(), adResponse);
        assertEquals(10, s1.getList(response).size());
    }

    @Test
    void readData() {
        try (MockedStatic<APIUtils> apiUtilsMockedStatic = Mockito.mockStatic(APIUtils.class)) {
            apiUtilsMockedStatic
                    .when(() -> APIUtils.get(Mockito.anyString(), Mockito.anyString(), Mockito.anyString()))
                    .thenReturn(adResponse);
            AdServiceImpl.getInstance().readData(accessToken, advertiser_id);
        }
    }

    private final String accessToken = "";
    private final String advertiser_id = "6791983391823626245";
    private final String adResponse = "{\"message\":\"OK\",\"code\":0,\"data\":{\"page_info\":{\"total_number\":10,\"page\":1,\"page_size\":10,\"total_page\":1},\"list\":[{\"open_url\":\"\",\"app_name\":\"\",\"ad_format\":\"SINGLE_VIDEO\",\"vast_moat\":false,\"playable_url\":\"\",\"landing_page_urls\":null,\"profile_image\":\"\",\"campaign_id\":1711095423090689,\"pixel_id\":null,\"create_time\":\"2021-09-16 21:30:35\",\"is_aco\":false,\"campaign_name\":\"[OPTIMIZER REGRESSION] Impressions 2\",\"click_tracking_url\":null,\"adgroup_id\":1711095499718706,\"display_name\":\"Unified\",\"adgroup_name\":\"Ad Group20210916171523\",\"image_ids\":[\"v0201\\/4fc886b414bc47a6a61c46d096c7e317\"],\"impression_tracking_url\":null,\"call_to_action_id\":null,\"page_id\":null,\"opt_status\":\"ENABLE\",\"status\":\"AD_STATUS_CAMPAIGN_DISABLE\",\"ad_id\":1711095473086513,\"ad_text\":\"Puppy Love\",\"advertiser_id\":6791983391823626245,\"is_creative_authorized\":false,\"identity_id\":\"\",\"ad_texts\":null,\"ad_name\":\"6901591606152970241_2021-09-16 17:29:28\",\"external_action\":null,\"open_url_type\":\"NORMAL\",\"is_new_structure\":true,\"identity_type\":null,\"video_id\":\"v07033ea0000bv3m4tu7fnc2qpse78tg\",\"card_id\":null,\"brand_safety_postbid_partner\":\"UNSET\",\"landing_page_url\":\"\",\"modify_time\":\"2021-09-16 21:31:02\"},{\"open_url\":\"\",\"app_name\":\"\",\"ad_format\":\"SINGLE_VIDEO\",\"vast_moat\":false,\"playable_url\":\"\",\"landing_page_urls\":null,\"profile_image\":\"\",\"campaign_id\":1699513776212018,\"pixel_id\":null,\"create_time\":\"2021-05-12 01:24:13\",\"is_aco\":false,\"campaign_name\":\"Video Views20210511212239\",\"click_tracking_url\":null,\"adgroup_id\":1699513776545809,\"display_name\":\"Tiktok video views\",\"adgroup_name\":\"Ad Group20210511212242\",\"image_ids\":[\"v0201\\/8d80fd072a834553a9a5d23264ad55ec\"],\"impression_tracking_url\":null,\"call_to_action_id\":null,\"page_id\":null,\"opt_status\":\"ENABLE\",\"status\":\"AD_STATUS_CAMPAIGN_DISABLE\",\"ad_id\":1699513769565202,\"ad_text\":\"Couple\",\"advertiser_id\":6791983391823626245,\"is_creative_authorized\":false,\"identity_id\":\"\",\"ad_texts\":null,\"ad_name\":\"Video16207826129670_New Dreams_2021-05-11 21:23:16\",\"external_action\":null,\"open_url_type\":\"NORMAL\",\"is_new_structure\":true,\"identity_type\":null,\"video_id\":\"v07033g50000c2diov8v9iaeunf6jd90\",\"card_id\":null,\"brand_safety_postbid_partner\":\"UNSET\",\"landing_page_url\":\"\",\"modify_time\":\"2021-09-20 23:06:12\"},{\"open_url\":\"\",\"app_name\":\"\",\"ad_format\":\"SINGLE_VIDEO\",\"vast_moat\":false,\"playable_url\":\"\",\"landing_page_urls\":null,\"profile_image\":\"\",\"campaign_id\":1696477648877570,\"pixel_id\":6881312699276394497,\"create_time\":\"2021-04-08 13:06:23\",\"is_aco\":false,\"campaign_name\":\"[Saigon](Conversion) iOS 14 check\",\"click_tracking_url\":null,\"adgroup_id\":1696477648877586,\"display_name\":\"Our-Mark\",\"adgroup_name\":\"[Saigon](Conversion) iOS 14 check\",\"fallback_type\":\"UNSET\",\"image_ids\":[\"v0201\\/fcdac4ccf39c416f980ead8cc9d26e71\"],\"impression_tracking_url\":null,\"call_to_action_id\":null,\"page_id\":null,\"opt_status\":\"ENABLE\",\"status\":\"AD_STATUS_DONE\",\"ad_id\":1696477648881698,\"ad_text\":\"Casual Outfit\",\"advertiser_id\":6791983391823626245,\"is_creative_authorized\":false,\"ad_texts\":null,\"ad_name\":\"[Saigon](Conversion) iOS 14 check\",\"external_action\":\"VIEW\",\"open_url_type\":\"NORMAL\",\"is_new_structure\":true,\"call_to_action\":\"LEARN_MORE\",\"video_id\":\"v07033da0000bv7t6762adup7se59pr0\",\"card_id\":null,\"landing_page_url\":\"http:\\/\\/www.our-mark.com\\/\",\"modify_time\":\"2021-04-18 18:01:32\"},{\"open_url\":\"\",\"app_name\":\"\",\"ad_format\":\"SINGLE_VIDEO\",\"vast_moat\":false,\"playable_url\":\"\",\"landing_page_urls\":null,\"profile_image\":\"\",\"campaign_id\":1696402182206514,\"pixel_id\":null,\"create_time\":\"2021-04-07 17:06:56\",\"is_aco\":false,\"campaign_name\":\"[Saigon](Reach) Update new endpoint\",\"click_tracking_url\":null,\"adgroup_id\":1696402193142818,\"display_name\":\"Cuties\",\"adgroup_name\":\"[Saigon](Reach) Update new endpoint\",\"image_ids\":[\"v0201\\/4fc886b414bc47a6a61c46d096c7e317\"],\"impression_tracking_url\":null,\"call_to_action_id\":null,\"page_id\":null,\"opt_status\":\"ENABLE\",\"status\":\"AD_STATUS_CAMPAIGN_DISABLE\",\"ad_id\":1696401815371777,\"ad_text\":\"How adorable\",\"advertiser_id\":6791983391823626245,\"is_creative_authorized\":false,\"ad_texts\":null,\"ad_name\":\"[Saigon](Reach) Update new endpoint\",\"external_action\":null,\"open_url_type\":\"NORMAL\",\"is_new_structure\":true,\"video_id\":\"v07033ea0000bv3m4tu7fnc2qpse78tg\",\"card_id\":null,\"landing_page_url\":\"\",\"modify_time\":\"2021-04-07 18:02:08\"},{\"open_url\":\"\",\"app_name\":\"iHeart: Radio, Music, Podcasts\",\"ad_format\":\"SINGLE_VIDEO\",\"vast_moat\":false,\"playable_url\":\"\",\"landing_page_urls\":null,\"profile_image\":\"https:\\/\\/p21-ad-sg.ibyteimg.com\\/large\\/app-market-data-sg\\/b3daf285549d15614e98bfa3a55ff526\",\"campaign_id\":1695218209136674,\"pixel_id\":null,\"create_time\":\"2021-03-25 15:27:50\",\"is_aco\":false,\"campaign_name\":\"IHM App Install Test Campaign\",\"click_tracking_url\":null,\"adgroup_id\":1695218200748081,\"display_name\":\"\",\"adgroup_name\":\"IHM App Install Test Ad Group\",\"image_ids\":[\"v0201\\/584e00be351e4037a6583193143205e5\"],\"impression_tracking_url\":null,\"call_to_action_id\":null,\"page_id\":null,\"opt_status\":\"ENABLE\",\"status\":\"AD_STATUS_DONE\",\"ad_id\":1695218154305570,\"ad_text\":\"Download the iHeartRadio app today\",\"advertiser_id\":6791983391823626245,\"is_creative_authorized\":false,\"ad_texts\":null,\"ad_name\":\"IHM Radio App Install_2021-03-25 11:27:08\",\"external_action\":null,\"open_url_type\":\"NORMAL\",\"is_new_structure\":true,\"call_to_action\":\"DOWNLOAD_NOW\",\"video_id\":\"v07033900000c1eam079pj5mq3qa0fgg\",\"card_id\":null,\"landing_page_url\":\"\",\"modify_time\":\"2021-03-26 02:44:09\"},{\"open_url\":\"\",\"app_name\":\"\",\"ad_format\":\"SINGLE_VIDEO\",\"vast_moat\":false,\"playable_url\":\"\",\"landing_page_urls\":null,\"profile_image\":\"\",\"campaign_id\":1693935468014609,\"pixel_id\":null,\"create_time\":\"2021-03-11 11:39:31\",\"is_aco\":false,\"campaign_name\":\"[OPTIMIZER REGRESSION] Media Budget Test_new\",\"click_tracking_url\":null,\"adgroup_id\":1693935465921569,\"display_name\":\"Shopaholic\",\"adgroup_name\":\"[OPTIMIZER REGRESSION] Media Budget Test_new\",\"image_ids\":[\"v0201\\/fcdac4ccf39c416f980ead8cc9d26e71\"],\"impression_tracking_url\":null,\"call_to_action_id\":null,\"page_id\":null,\"opt_status\":\"ENABLE\",\"status\":\"AD_STATUS_CAMPAIGN_DISABLE\",\"ad_id\":1693935465923601,\"ad_text\":\"Confident with your outfits\",\"advertiser_id\":6791983391823626245,\"is_creative_authorized\":false,\"ad_texts\":null,\"ad_name\":\"[OPTIMIZER REGRESSION] Media Budget Test_new\",\"external_action\":null,\"open_url_type\":\"NORMAL\",\"is_new_structure\":true,\"call_to_action\":\"LEARN_MORE\",\"video_id\":\"v07033da0000bv7t6762adup7se59pr0\",\"card_id\":null,\"landing_page_url\":\"http:\\/\\/www.our-mark.com\\/\",\"modify_time\":\"2021-09-20 13:04:12\"},{\"open_url\":\"\",\"app_name\":\"\",\"ad_format\":\"SINGLE_VIDEO\",\"vast_moat\":false,\"playable_url\":\"\",\"landing_page_urls\":null,\"profile_image\":\"\",\"campaign_id\":1692951394653217,\"pixel_id\":null,\"create_time\":\"2021-02-28 14:57:49\",\"is_aco\":false,\"campaign_name\":\"[OPTIMIZER REGRESSION] Impressions Test\",\"click_tracking_url\":null,\"adgroup_id\":1692951392901170,\"display_name\":\"Enjoy\",\"adgroup_name\":\"[OPTIMIZER REGRESSION] Impressions Test\",\"image_ids\":[\"tos-useast2a-p-0000\\/b85c2f199ce646a5b7e4b1180e591e1c\"],\"impression_tracking_url\":null,\"call_to_action_id\":null,\"page_id\":null,\"opt_status\":\"ENABLE\",\"status\":\"AD_STATUS_CAMPAIGN_DISABLE\",\"ad_id\":1692951377889330,\"ad_text\":\"Quick and Easy for diet.\",\"advertiser_id\":6791983391823626245,\"is_creative_authorized\":false,\"identity_id\":\"\",\"ad_texts\":null,\"ad_name\":\"[OPTIMIZER REGRESSION] Impressions Test\",\"external_action\":null,\"open_url_type\":\"NORMAL\",\"is_new_structure\":true,\"identity_type\":null,\"video_id\":\"v090332d0000bptdv3i6aghe7s4rj76g\",\"card_id\":null,\"brand_safety_postbid_partner\":\"UNSET\",\"landing_page_url\":\"\",\"modify_time\":\"2021-09-20 11:02:25\"},{\"open_url\":\"\",\"app_name\":\"\",\"ad_format\":\"SINGLE_VIDEO\",\"vast_moat\":false,\"playable_url\":\"\",\"landing_page_urls\":null,\"profile_image\":\"\",\"campaign_id\":1692951105318945,\"pixel_id\":null,\"create_time\":\"2021-02-28 14:53:38\",\"is_aco\":false,\"campaign_name\":\"[OPTIMIZER REGRESSION] Media Budget Test\",\"click_tracking_url\":null,\"adgroup_id\":1692951104063490,\"display_name\":\"Enjoy\",\"adgroup_name\":\"[OPTIMIZER REGRESSION] Media Budget Test\",\"image_ids\":[\"tos-useast2a-p-0000\\/b85c2f199ce646a5b7e4b1180e591e1c\"],\"impression_tracking_url\":null,\"call_to_action_id\":null,\"page_id\":null,\"opt_status\":\"ENABLE\",\"status\":\"AD_STATUS_CAMPAIGN_DISABLE\",\"ad_id\":1692951104063538,\"ad_text\":\"Relax yourself\",\"advertiser_id\":6791983391823626245,\"is_creative_authorized\":false,\"ad_texts\":null,\"ad_name\":\"[OPTIMIZER REGRESSION] Media Budget Test\",\"external_action\":null,\"open_url_type\":\"NORMAL\",\"is_new_structure\":true,\"video_id\":\"v090332d0000bptdv3i6aghe7s4rj76g\",\"card_id\":null,\"landing_page_url\":\"\",\"modify_time\":\"2021-03-09 16:13:34\"},{\"open_url\":\"\",\"app_name\":\"\",\"ad_format\":\"SINGLE_VIDEO\",\"vast_moat\":false,\"playable_url\":\"\",\"landing_page_urls\":null,\"profile_image\":\"\",\"campaign_id\":1684959703362578,\"pixel_id\":6881312699276394497,\"create_time\":\"2020-12-08 19:29:48\",\"is_aco\":false,\"campaign_name\":\"[Red] Conversions 2020.12.02\",\"click_tracking_url\":null,\"adgroup_id\":1685539556928545,\"display_name\":\"Our Mark\",\"adgroup_name\":\"Our Mark Conversions\",\"fallback_type\":\"UNSET\",\"image_ids\":[\"v0201\\/fcdac4ccf39c416f980ead8cc9d26e71\"],\"impression_tracking_url\":null,\"call_to_action_id\":null,\"page_id\":null,\"opt_status\":\"ENABLE\",\"status\":\"AD_STATUS_DONE\",\"ad_id\":1685539548793905,\"ad_text\":\"Shopping Made Simple\",\"advertiser_id\":6791983391823626245,\"is_creative_authorized\":false,\"ad_texts\":null,\"ad_name\":\"Our Mark Ad\",\"external_action\":\"VIEW\",\"open_url_type\":\"NORMAL\",\"is_new_structure\":true,\"call_to_action\":\"LEARN_MORE\",\"video_id\":\"v07033da0000bv7t6762adup7se59pr0\",\"card_id\":null,\"landing_page_url\":\"http:\\/\\/www.our-mark.com\\/\",\"modify_time\":\"2020-12-08 19:52:10\"},{\"open_url\":\"\",\"app_name\":\"\",\"ad_format\":\"SINGLE_VIDEO\",\"vast_moat\":false,\"playable_url\":\"\",\"landing_page_urls\":null,\"profile_image\":\"\",\"campaign_id\":1685389349052433,\"pixel_id\":6852753141281128454,\"create_time\":\"2020-12-07 03:42:17\",\"is_aco\":false,\"campaign_name\":\"Red-Conversions20201206222133\",\"click_tracking_url\":null,\"adgroup_id\":1685389349830674,\"display_name\":\"Diet dishes\",\"adgroup_name\":\"Ad Group20201206223839\",\"fallback_type\":\"UNSET\",\"image_ids\":[\"tos-useast2a-p-0000\\/b85c2f199ce646a5b7e4b1180e591e1c\"],\"impression_tracking_url\":null,\"call_to_action_id\":null,\"page_id\":null,\"opt_status\":\"ENABLE\",\"status\":\"AD_STATUS_DONE\",\"ad_id\":1685389349526577,\"ad_text\":\"Quick and Easy for diet.\",\"advertiser_id\":6791983391823626245,\"is_creative_authorized\":false,\"ad_texts\":null,\"ad_name\":\"Ad Name20201206224024\",\"external_action\":\"ON_WEB_DETAIL\",\"open_url_type\":\"NORMAL\",\"is_new_structure\":true,\"call_to_action\":\"WATCH_NOW\",\"video_id\":\"v090332d0000bptdv3i6aghe7s4rj76g\",\"card_id\":null,\"landing_page_url\":\"https:\\/\\/damndelicious.net\\/\",\"modify_time\":\"2020-12-08 18:44:26\"}]},\"request_id\":\"202110070911290102450232210DAE329C\"}";
}